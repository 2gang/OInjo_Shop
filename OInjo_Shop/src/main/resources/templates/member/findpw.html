<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../../static/css/findpw.css">
  <!--<script src="../static/js/findpw.js" defer></script> -->
  <title>비밀번호 찾기</title>
</head>

<body>
<form action="/member/findpw" method="post">
<h3>비밀번호 찾기</h3>
    <div class="page-button-wrapper">
      <a href="#" class="page-button other-page">아이디 찾기</a>
      <a href="#" class="page-button now-page">비밀번호 찾기</a>
    </div>
    <div class="email-input-box-wrapper">
      <input type="email" name="" id="" placeholder="이메일을 입력하세요" class="email-input">
      <button type="button" class="input-submit-button certification-start-button">인증번호 전송</button>
    </div>
    <div class="certification-number-input-box-wrapper">
      <input type="text" name="" id="" placeholder="인증번호를 입력하세요" class="certification-number-input">
      <button type="button" class="input-submit-button certification-button">확인</button>
    </div>
    <input type="submit" value="비밀번호 찾기" class="find-button">
  </form>
  <p class="result-message">새로운 비밀번호: <span th:text="${password}"></span></p>
  <script>
//이메일 인증 구현 시작
const certificationStartButton = document.querySelector(
  ".certification-start-button"
);
const emailInput = document.querySelector(".email-input");
certificationStartButton.addEventListener("click", () => {
  fetch("/login/mailAuthentication?email=" + emailInput.value, {
    method: "POST",
    body: JSON.stringify({
      email: emailInput.value,
    }),
    headers: {
      "Content-Type": "application/json",
    },
  })
    .then((response) => {
      console.log("response:", response);
    })
    .catch((error) => console.log("error:", error));
});

const certificationButton = document.querySelector(".certification-button");
const certificationNumber = document.querySelector(".certification-number-input");
certificationButton.addEventListener("click", () => {
  const url = `/member/findpw?email=${emailInput.value}&code=${certificationNumber.value}`;
    fetch(url, {
        method: "POST",
        body: JSON.stringify({
            email: emailInput.value,
            certificationNumber: certificationNumber.value,
        }),
        headers: {
            "Content-Type": "application/json",
        },
    })
        .then((response) => {
            if (response.ok) {
                return response.text();
            } else {
                throw new Error("인증 실패");
            }
        })
        .then((data) => {
            document.querySelector(".result-message span").textContent = data;
        })
        .catch((error) => {
            console.log("error:", error);
            document.querySelector(".result-message span").textContent = "인증 실패";
        })});
  </script>
</body>

</html>